<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COOPERATIVA CLAF - SISTEMA DE IMPRESS√ÉO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');

        /* CONFIGURA√á√ïES DE IMPRESS√ÉO */
        @media print {
            body { background-color: white !important; padding: 0 !important; }
            .no-print { display: none !important; }
            .max-w-md { max-width: 100% !important; border: none !important; box-shadow: none !important; }
            .fonte-cupom { font-size: 12pt !important; }
            .cabecalho-tabela { background-color: #eee !important; -webkit-print-color-adjust: exact; }
            .border-print { border: 1pt solid black !important; }
            table { width: 100% !important; border-collapse: collapse !important; }
            th, td { border: 0.5pt solid #ccc !important; }
            input { border: none !important; background: transparent !important; }
            @page { margin: 1.5cm; }
        }

        body { -webkit-tap-highlight-color: transparent; background-color: #f3f4f6; }
        .fonte-cupom { font-family: 'Courier Prime', monospace; }
        .cabecalho-tabela { background-color: #ffff00; }
        
        /* Estiliza√ß√£o dos Inputs */
        input[type="number"] { -moz-appearance: textfield; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        .sombra-mobile {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fadeIn { animation: fadeIn 0.5s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .animate-pop { animation: pop 0.3s ease-out forwards; }
    </style>
</head>
<body class="min-h-screen font-sans">

<div class="max-w-2xl mx-auto bg-white min-h-screen shadow-2xl border-x border-gray-200 flex flex-col animate-fadeIn">
    
    <!-- CABE√áALHO FORMATADO PARA IMPRESS√ÉO -->
    <header class="bg-green-800 p-10 text-white text-center border-b-4 border-yellow-400">
        <h1 class="text-2xl font-bold uppercase tracking-[0.3em] opacity-80">Cooperativa</h1>
        <h2 class="text-7xl font-black uppercase tracking-tighter leading-none italic text-yellow-400">CLAF</h2>
        <div class="mt-4 h-1 w-32 bg-white mx-auto"></div>
        <p class="text-xs font-bold mt-4 uppercase tracking-[0.4em]">Relat√≥rio de Entrega de Produtos</p>
    </header>

    <form id="meuFormulario" class="p-6 space-y-8 flex-grow">
        
        <!-- SE√á√ÉO DE IDENTIFICA√á√ÉO -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-gray-50 p-6 rounded-3xl border border-gray-200 sombra-mobile">
            <div>
                <label class="block text-[10px] font-black text-green-700 mb-2 uppercase tracking-widest italic">1. Nome do Produtor / Respons√°vel</label>
                <input type="text" name="nome" id="nomeProdutor" 
                       class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-green-600 outline-none text-xl font-bold uppercase text-black" 
                       placeholder="DIGITE O NOME" required>
            </div>
            <div>
                <label class="block text-[10px] font-black text-green-700 mb-2 uppercase tracking-widest italic">2. Data da Opera√ß√£o</label>
                <input type="date" name="data" id="campoData" 
                       class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-green-600 outline-none text-xl font-bold text-black" required>
            </div>
        </div>

        <!-- TABELA DE CONFER√äNCIA -->
        <div class="border-2 border-black rounded-2xl overflow-hidden bg-white sombra-mobile">
            <table class="w-full border-collapse fonte-cupom">
                <thead>
                    <tr class="cabecalho-tabela">
                        <th class="border-b-2 border-black p-4 text-sm font-black uppercase text-left w-3/5">DESCRI√á√ÉO DO PRODUTO</th>
                        <th class="border-b-2 border-black p-4 text-sm font-black uppercase text-center w-2/5">QUANTIDADE (UN/KG)</th>
                    </tr>
                </thead>
                <tbody id="listaProdutos" class="divide-y divide-gray-200">
                    <!-- Gerado dinamicamente -->
                </tbody>
            </table>
        </div>

        <!-- BOT√ïES (ESCONDIDOS NA IMPRESS√ÉO) -->
        <div class="no-print space-y-4 pt-4 pb-10">
            <button type="submit" id="btnEnviar" class="w-full bg-green-600 hover:bg-green-700 text-white py-6 rounded-2xl font-black text-2xl shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-4">
                ENVIAR E SALVAR SOMA
            </button>
            <button type="button" onclick="window.print()" class="w-full bg-gray-800 hover:bg-black text-white py-4 rounded-2xl font-bold text-lg transition-all flex items-center justify-center gap-2">
                üñ®Ô∏è IMPRIMIR RECIBO
            </button>
        </div>
    </form>

    <footer class="bg-gray-100 p-8 text-center border-t border-gray-200">
        <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.5em]">--- CONTROLE INTERNO CLAF ---</p>
    </footer>
</div>

<!-- MODAL DE SUCESSO -->
<div id="modalSucesso" class="fixed inset-0 bg-black/90 hidden items-center justify-center p-6 z-50 backdrop-blur-md no-print">
    <div class="bg-white p-10 rounded-[3rem] text-center max-w-sm w-full border-[10px] border-green-500 shadow-2xl animate-pop">
        <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6 text-5xl">‚úì</div>
        <h2 class="text-3xl font-black text-green-800 uppercase mb-2">SALVO!</h2>
        <p class="text-gray-500 font-bold mb-8 text-sm uppercase">A soma foi processada na aba ORGANIZA√á√ÉO_DE_DADOS.</p>
        <button onclick="location.reload()" class="w-full bg-green-700 text-white py-5 rounded-2xl font-black uppercase tracking-tighter">FAZER NOVO</button>
    </div>
</div>

<script>
    const produtos = ["Abacate", "Abacaxi", "Banana caturra", "Banana ma√ß√£ ou prata", "Laranja baiana lima", "Laranja Comum", "Ma√ß√£", "Mam√£o", "Manga", "Maracuj√°", "Melancia", "Mel√£o", "Pera", "P√™ssego", "Tangerina ponc√£", "Almeir√£o", "Acelga", "Agri√£o", "Alface", "Couve Manteiga", "Escarola", "Espinafre", "Quiabo", "Repolho", "R√∫cula", "Abobrinha verde", "Beterraba", "Br√≥colis", "Cenoura", "Chuchu", "Couve flor", "Milho verde", "Pepino", "Tomate", "Vagem", "Leite Pasteurizado", "P√£o Caseiro", "Alho por√≥", "Cebola", "Cebolinha Verde", "Lim√£o", "Piment√£o", "Rabanete", "Salsinha", "Batata doce", "Batata inglesa", "Iogurte"];

    // Configura data atual
    document.getElementById('campoData').value = new Date().toISOString().split('T')[0];

    const tbody = document.getElementById('listaProdutos');
    produtos.forEach((prod) => {
        const tr = document.createElement('tr');
        // O ID de envio deve ser consistente para a soma na planilha
        const idKey = prod.normalize('NFD').replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '_').toUpperCase();
        
        tr.innerHTML = `
            <td class="p-4 font-bold text-gray-700 uppercase border-r border-gray-100">${prod}</td>
            <td class="p-2">
                <input type="number" name="${idKey}" step="any" inputmode="decimal"
                       class="w-full p-3 text-center text-xl font-black bg-gray-50 rounded-lg outline-none focus:bg-yellow-50 transition-colors text-black" 
                       placeholder="-">
            </td>
        `;
        tbody.appendChild(tr);
    });

    document.getElementById('meuFormulario').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('btnEnviar');
        const URL_DO_SCRIPT = "https://script.google.com/macros/s/AKfycbwj9Pw6zH5ZVKVjqS5eomVO6kHSZUbtNmcVr6DeA8EmISvqmyTNtwuo-MWlwrdFCl17/exec";

        btn.disabled = true;
        btn.innerHTML = "PROCESSANDO SOMA...";

        const formData = new FormData(this);
        const params = new URLSearchParams();
        
        // Garante que o nome do produtor v√° em mai√∫sculas para evitar duplicidade na soma
        formData.forEach((value, key) => {
            if (value && value !== "0" && value !== "") {
                if (key === "nome") {
                    params.append(key, value.trim().toUpperCase());
                } else {
                    params.append(key, value);
                }
            }
        });

        fetch(URL_DO_SCRIPT, { method: 'POST', mode: 'no-cors', body: params })
        .then(() => {
            document.getElementById('modalSucesso').style.display = 'flex';
            window.scrollTo(0,0);
        })
        .catch(() => {
            alert("Erro ao salvar! Verifique a internet.");
            btn.disabled = false;
            btn.innerHTML = "ENVIAR E SALVAR SOMA";
        });
    });
</script>

</body>
</html>
